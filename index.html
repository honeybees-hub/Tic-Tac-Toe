<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animation for the winner */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: popIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col items-center justify-center font-sans">

    <!-- Game Container -->
    <div class="w-full max-w-md p-6 bg-slate-800 rounded-xl shadow-2xl border border-slate-700">
        
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-teal-400 mb-2">Tic Tac Toe</h1>
            
            <!-- Mode Selection -->
            <div class="flex justify-center gap-2 mb-4">
                <button id="pvpBtn" class="px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-semibold shadow-lg hover:bg-teal-500 transition border-2 border-teal-400">
                    Vs Player
                </button>
                <button id="pvcBtn" class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm font-semibold hover:bg-slate-600 transition border-2 border-transparent">
                    Vs Computer
                </button>
            </div>

            <p id="status" class="text-xl text-slate-300">Player X's turn</p>
        </div>

        <!-- Game Board (3x3 Grid) -->
        <div class="grid grid-cols-3 gap-3 mb-8 mx-auto w-full aspect-square max-w-[300px]">
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="0"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="1"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="2"></button>
            
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="3"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="4"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="5"></button>
            
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="6"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="7"></button>
            <button class="cell bg-slate-700 hover:bg-slate-600 rounded-lg text-4xl font-bold flex items-center justify-center transition-all duration-200 h-24 w-full" data-index="8"></button>
        </div>

        <!-- Restart Button -->
        <button id="restartBtn" class="w-full py-3 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-lg transition-colors hidden">
            Play Again
        </button>
    </div>

    <script>
        // Game State
        let board = ["", "", "", "", "", "", "", "", ""];
        let currentPlayer = "X";
        let gameActive = true;
        let isVsComputer = false; // Default to PvP

        // DOM Elements
        const statusDisplay = document.getElementById('status');
        const cells = document.querySelectorAll('.cell');
        const restartBtn = document.getElementById('restartBtn');
        const pvpBtn = document.getElementById('pvpBtn');
        const pvcBtn = document.getElementById('pvcBtn');

        const winConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
            [0, 4, 8], [2, 4, 6]             // Diagonals
        ];

        // Mode Selection Handlers
        pvpBtn.addEventListener('click', () => setGameMode(false));
        pvcBtn.addEventListener('click', () => setGameMode(true));

        function setGameMode(vsComputer) {
            isVsComputer = vsComputer;
            
            // Update UI Button Styles
            if (isVsComputer) {
                pvcBtn.classList.replace('bg-slate-700', 'bg-teal-600');
                pvcBtn.classList.replace('text-slate-300', 'text-white');
                pvcBtn.classList.add('border-teal-400', 'border-2');
                pvcBtn.classList.remove('border-transparent');
                
                pvpBtn.classList.replace('bg-teal-600', 'bg-slate-700');
                pvpBtn.classList.replace('text-white', 'text-slate-300');
                pvpBtn.classList.remove('border-teal-400');
                pvpBtn.classList.add('border-transparent');
            } else {
                pvpBtn.classList.replace('bg-slate-700', 'bg-teal-600');
                pvpBtn.classList.replace('text-slate-300', 'text-white');
                pvpBtn.classList.add('border-teal-400');
                pvpBtn.classList.remove('border-transparent');
                
                pvcBtn.classList.replace('bg-teal-600', 'bg-slate-700');
                pvcBtn.classList.replace('text-white', 'text-slate-300');
                pvcBtn.classList.remove('border-teal-400');
                pvcBtn.classList.add('border-transparent');
            }
            restartGame();
        }

        function handleCellClick(clickedCellEvent) {
            const clickedCell = clickedCellEvent.target;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));

            // Prevent moves if:
            // 1. Cell is taken
            // 2. Game is over
            // 3. It's Computer's turn (in PvC mode)
            if (board[clickedCellIndex] !== "" || !gameActive || (isVsComputer && currentPlayer === 'O')) {
                return;
            }

            handlePlayerMove(clickedCell, clickedCellIndex);
            
            // If game is still active and it's Computer mode, trigger computer
            if (gameActive && isVsComputer) {
                setTimeout(makeComputerMove, 500); // 500ms delay for realism
            }
        }

        function handlePlayerMove(clickedCell, clickedCellIndex) {
            board[clickedCellIndex] = currentPlayer;
            clickedCell.innerText = currentPlayer;
            
            if (currentPlayer === "X") {
                clickedCell.classList.add("text-teal-400");
            } else {
                clickedCell.classList.add("text-rose-400");
            }

            handleResultValidation();
        }

        function makeComputerMove() {
            if (!gameActive) return;

            let moveIndex;

            // Simple AI Logic:
            // 1. Try to win
            moveIndex = findBestMove("O"); 
            // 2. If can't win, block player
            if (moveIndex === -1) moveIndex = findBestMove("X");
            // 3. Pick random available spot
            if (moveIndex === -1) {
                const availableMoves = board.map((val, idx) => val === "" ? idx : null).filter(val => val !== null);
                moveIndex = availableMoves[Math.floor(Math.random() * availableMoves.length)];
            }

            const cell = document.querySelector(`[data-index='${moveIndex}']`);
            handlePlayerMove(cell, moveIndex);
        }

        function findBestMove(player) {
            // Check all winning combinations to see if 'player' can win/block
            for (let i = 0; i < winConditions.length; i++) {
                const [a, b, c] = winConditions[i];
                const values = [board[a], board[b], board[c]];
                
                // If 2 cells are 'player' and 1 is empty, pick the empty one
                if (values.filter(v => v === player).length === 2 && values.includes("")) {
                    if (board[a] === "") return a;
                    if (board[b] === "") return b;
                    if (board[c] === "") return c;
                }
            }
            return -1;
        }

        function handleResultValidation() {
            let roundWon = false;
            let winningLine = [];

            for (let i = 0; i <= 7; i++) {
                const winCondition = winConditions[i];
                let a = board[winCondition[0]];
                let b = board[winCondition[1]];
                let c = board[winCondition[2]];

                if (a === '' || b === '' || c === '') continue;
                if (a === b && b === c) {
                    roundWon = true;
                    winningLine = winCondition;
                    break;
                }
            }

            if (roundWon) {
                statusDisplay.innerHTML = `Player <span class="${currentPlayer === 'X' ? 'text-teal-400' : 'text-rose-400'} font-bold">${currentPlayer}</span> wins!`;
                gameActive = false;
                highlightWinningCells(winningLine);
                restartBtn.classList.remove('hidden');
                restartBtn.classList.add('pop-in');
                return;
            }

            let roundDraw = !board.includes("");
            if (roundDraw) {
                statusDisplay.innerText = "It's a draw!";
                gameActive = false;
                restartBtn.classList.remove('hidden');
                restartBtn.classList.add('pop-in');
                return;
            }

            currentPlayer = currentPlayer === "X" ? "O" : "X";
            statusDisplay.innerText = `Player ${currentPlayer}'s turn`;
        }

        function highlightWinningCells(indices) {
            indices.forEach(index => {
                cells[index].classList.remove('bg-slate-700');
                cells[index].classList.add('bg-slate-500', 'scale-105');
            });
        }

        function restartGame() {
            gameActive = true;
            currentPlayer = "X";
            board = ["", "", "", "", "", "", "", "", ""];
            statusDisplay.innerText = "Player X's turn";
            restartBtn.classList.add('hidden');

            cells.forEach(cell => {
                cell.innerText = "";
                cell.classList.remove("text-teal-400", "text-rose-400", "bg-slate-500", "scale-105");
                cell.classList.add("bg-slate-700");
            });
        }

        // Initialize Listeners
        cells.forEach(cell => cell.addEventListener('click', handleCellClick));
        restartBtn.addEventListener('click', restartGame);
    </script>
</body>
</html>